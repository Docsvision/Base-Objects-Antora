= Настройка работы с КриптоПро

// TODO -- криптофакинпро

Для возможности подписания документов ЭП с использованием криптопровайдера КриптоПро, администратор должен выполнить предварительные настройки.

. Установите на компьютер с сервером {dv} и на клиентские компьютеры компоненты КриптоПро, см. требования в xref:ROOT:requirements.adoc#crypto-pro[этом] пункте.
. Откройте справочник _Системные настройки_ от имени администратора {dv}.
. Перейдите в раздел menu:{bo}[Подписи и шифрование].
+
.Настройки подписи и шифрования базовых объектов
image::signature-encryption.png[Настройки подписи и шифрования базовых объектов]
+
. Настройте параметры подписания и шифрования.
+
[lowerroman]
.. В поле _Провайдер_ выберите значение `Crypto-Pro GOST R 34.10-2012 Cryptographic Service Provider` или `Crypto-Pro GOST R 34.10-2012 Strong Cryptographic Service Provider` в зависимости от алгоритма, с помощью которого были сгенерированы сертификаты.
.. В поле _Алгоритм шифрования_ выберите *_GOST 28147-89_*.
.. В поле _Алгоритм подписи_ выберите *_GOST R 34.11-2012 256_* или *_GOST R 34.11-2012 256_* в зависимости от выбранного _провайдера_.
.. В поле _TSP провайдер_ выберите файл `Каталог-установки-{wincl}/BaseObjects/{dv}.BackOffice.ObjectModel.CryptoPro.dll`.
.. В поле _Адрес TSP сервиса_ введите адрес службы штампов времени, предоставляющей штампы времени для ЭП.footnote:[Адрес тестового TSP-сервера компании КриптоПро: http://testca.cryptopro.ru/tsp/tsp.srf. Для получения актуальных адресов тестового и рабочего TSP-сервера рекомендуется обращаться в компанию КриптоПро.]
+
.. В поле _OCSP провайдер_ выберите файл `Каталог-установки-{wincl}/BaseObjects/{dv}.BackOffice.ObjectModel.CryptoPro.dll`.
.. При необходимости настройте остальные параметры.
+
// Указывать адрес OCSP сервиса не требуется.
+
. Установите сертификаты КриптоПро:
+
[lowerroman]
.. Корневой сертификат удостоверяющего центра, выпустившего сертификат пользователяfootnote:[Например, корневой сертификат КриптоПро.] в хранилище "Доверенные корневые центры сертификации" на уровне "Локальный компьютер" на компьютер с сервером {dv} и на клиентские компьютеры.
.. Сертификат пользователя в хранилище "Личное" на уровне "Текущий пользователь" на клиентские компьютеры.
+
В данной инструкции перечислены действия по настройке {dv} с точки зрения "классического" варианта установки сертификатов КриптоПро -- сертификаты устанавливаются на компьютер пользователя. При использовании функции КриптоПро "Облачный провайдер" (КриптоПро CSP 5.0 и выше), система {dv} настраивается аналогичным образом, а установка сертификатов должна выполняться по инструкции компании КриптоПро для работы с "облачными токенами".
+
[WARNING]
====
В случае, если лицензия на компоненты КриптоПро CSP истекла, возможность добавлять новые подписи будет заблокирована.

Возможность проверки подписей с ещё действующим сертификатом не блокируется. Старые подписи будут проверяться в любом случае.
====

[#ocspcom]
== Настройка работы с КриптоПро OCSPCOM

КриптоПро OCSPCOM 2.0 при проверке подписи создаёт собственное неописанное прокси-соединение, вместо обращения через системный прокси.

Если подобные прокси-соединения не соответствуют политике корпоративной сети, следуйте инструкциям по созданию и использованию дополнительных прокси-соединений в https://cpdn.cryptopro.ru/content/pkisdk/html/OCSP/ocspgp/index.html[документации КриптоПро].
